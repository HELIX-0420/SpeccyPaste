<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>SpeccyPaste</title>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/devicons/devicon@latest/devicon.min.css">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" />
  <link rel="stylesheet" href="/style.css" />
  <style>html, body { overflow: hidden; }</style>
</head>
<body>
  <aside class="sidebar">
    <div class="profile">
      <img src="https://media.discordapp.net/attachments/358786567738884126/1376996942634291290/avatar.png?ex=684c73d6&is=684b2256&hm=e1e82b150d7efbfa8219d764483d536ce19100407f5e681598b869d7e9d04a7e&=&format=webp&quality=lossless" alt="Avatar" class="avatar" />
      <h2>SpeccyPaste</h2>
      <p class="subtitle">Coded With</p>
      <div class="badges icons">
        <i class="devicon-javascript-plain colored" title="JavaScript"></i>
        <i class="devicon-nodejs-plain colored" title="Node.js"></i>
        <i class="devicon-html5-plain colored" title="HTML5"></i>
        <i class="devicon-css3-plain colored" title="CSS3"></i>
      </div>
    </div>

    <nav class="nav">
      <a href="/"><span>üìã</span> New Paste</a>
      <a href="#" id="saveBtn"><span>üíæ</span> Save Paste</a>
      <a href="#"><span>üé®</span> Themes</a>
      <a href="#"><span>üåô</span> Dark Mode</a>
    </nav>

    <footer>
      <div class="social-icons">
        <a href="https://discord.com/users/129415071175671808" target="_blank"><i class="fab fa-discord"></i></a>
        <a href="https://twitter.com/yourhandle" target="_blank"><i class="fab fa-twitter"></i></a>
        <a href="https://github.com/yourhandle" target="_blank"><i class="fab fa-github"></i></a>
        <a href="mailto:you@example.com"><i class="fas fa-envelope"></i></a>
      </div>
      <p>&copy; 2025 Speccynerd.dev</p>
    </footer>
  </aside>

  <main class="paste-main">
    <p id="expiryInfo" class="paste-expiry-message" style="display: none;"></p>
    <div class="paste-header">
      <h1 class="logo">SpeccyPaste</h1>
    </div>

    <div class="editor-container">
      <div class="floating-actions top-right">
        <button id="copyBtn"><i class="fas fa-copy"></i></button>
        <button id="shareBtn"><i class="fas fa-link"></i></button>
        <button id="rawBtn" title="View Raw"><i class="fas fa-code"></i></button>

        <select id="language" title="Select Language">
          <optgroup label="-- text --">
            <option value="plaintext" selected>plain</option>
            <option value="log">log</option>
          </optgroup>
          <optgroup label="-- code --">
            <option value="javascript">javascript</option>
            <option value="typescript">typescript</option>
            <option value="java">java</option>
            <option value="python">python</option>
            <option value="c">c</option>
            <option value="cpp">cpp</option>
            <option value="csharp">csharp</option>
            <option value="go">go</option>
            <option value="rust">rust</option>
            <option value="php">php</option>
          </optgroup>
          <optgroup label="-- web --">
            <option value="html">html</option>
            <option value="css">css</option>
            <option value="json">json</option>
            <option value="xml">xml</option>
            <option value="markdown">markdown</option>
          </optgroup>
        </select>

        <select id="expiry" title="Expiration">
          <option value="60" selected>1 Hour</option>
          <option value="1440">1 Day</option>
          <option value="10080">7 Days</option>
          <option value="43200">30 Days</option>
        </select>
      </div>
      <div id="editor" class="code-box"></div>
    </div>
  </main>

  <script src="https://cdn.jsdelivr.net/npm/monaco-editor@0.44.0/min/vs/loader.js"></script>
  <script>
    require.config({ paths: { vs: "https://cdn.jsdelivr.net/npm/monaco-editor@0.44.0/min/vs" } });

    let monacoEditor;
    const urlParts = window.location.pathname.split("/");
    const pasteId = urlParts[1] === "p" ? urlParts[2] : null;

    require(["vs/editor/editor.main"], function () {
      monacoEditor = monaco.editor.create(document.getElementById("editor"), {
        value: "// Paste your code here...",
        language: "plaintext",
        theme: "vs-dark",
        fontSize: 14,
        lineNumbers: "on",
        automaticLayout: true,
        scrollBeyondLastLine: true
      });

      if (pasteId) {
        fetch(`/raw/${pasteId}`)
          .then(res => res.ok ? res.text() : Promise.reject("Not found"))
          .then(code => {
            monacoEditor.setValue(code);
            monacoEditor.updateOptions({ readOnly: true });
            document.getElementById("saveBtn").style.display = "none";
            document.getElementById("shareBtn").disabled = true;
            document.getElementById("language").disabled = true;
            document.getElementById("expiry").disabled = true;

            const storedLang = localStorage.getItem(`lang-${pasteId}`);
            const storedExpiry = localStorage.getItem(`expiry-${pasteId}`);

            if (storedLang) {
              monaco.editor.setModelLanguage(monacoEditor.getModel(), storedLang);
              document.getElementById("language").value = storedLang;
            }

            if (storedExpiry) {
              document.getElementById("expiry").value = storedExpiry;
            }
          })
          .catch(() => monacoEditor.setValue("// Paste not found"));
      }

      document.getElementById("language").addEventListener("change", function () {
        const lang = this.value;
        monaco.editor.setModelLanguage(monacoEditor.getModel(), lang);
        if (pasteId) {
          localStorage.setItem(`lang-${pasteId}`, lang);
        }
      });

      document.getElementById("copyBtn").addEventListener("click", function () {
        navigator.clipboard.writeText(monacoEditor.getValue());
        alert("Copied!");
      });

      document.getElementById("shareBtn").addEventListener("click", function () {
        const content = monacoEditor.getValue();
        const expiry = parseInt(document.getElementById("expiry").value);
        const lang = document.getElementById("language").value;

        fetch("/documents", {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({ content, expiry })
        })
          .then(res => res.json())
          .then(data => {
            localStorage.setItem(`lang-${data.key}`, lang);
            localStorage.setItem(`expiry-${data.key}`, expiry);
            const url = `/p/${data.key}`;
            navigator.clipboard.writeText(`${window.location.origin}${url}`);
            window.history.pushState({}, '', url);
            alert("Shared! URL copied: " + window.location.origin + url);
          })
          .catch(() => alert("Failed to save paste"));
      });

      document.getElementById("saveBtn").addEventListener("click", function () {
        document.getElementById("shareBtn").click();
      });

      document.getElementById("rawBtn").addEventListener("click", function () {
        if (pasteId) {
          window.open(`/raw/${pasteId}`, '_blank');
        }
      });
    });

    if (pasteId) {
      const expiryInfoEl = document.getElementById("expiryInfo");

      fetch(`/meta/${pasteId}`)
        .then(res => res.json())
        .then(meta => {
          expiryInfoEl.style.display = "block";

          const updateTimer = () => {
            const remaining = meta.expires - Date.now();
            if (remaining > 0) {
              const days = Math.floor(remaining / (1000 * 60 * 60 * 24));
              const hours = Math.floor((remaining % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
              const minutes = Math.floor((remaining % (1000 * 60 * 60)) / (1000 * 60));
              const seconds = Math.floor((remaining % (1000 * 60)) / 1000);
              expiryInfoEl.innerText = `‚è≥ This paste will expire in ${days}d ${hours}h ${minutes}m ${seconds}s.`;
            } else {
              expiryInfoEl.innerText = "‚ö†Ô∏è This paste has expired.";
              clearInterval(timerInterval);
            }
          };

          updateTimer(); // run immediately
          const timerInterval = setInterval(updateTimer, 1000);
        });
    }

  </script>
</body>
</html>
